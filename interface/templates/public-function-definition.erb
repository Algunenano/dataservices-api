--
-- Public geocoder API function
--
-- These are the only ones with permissions to publicuser role
-- and should also be the only ones with SECURITY DEFINER

CREATE OR REPLACE FUNCTION <%= GEOCODER_CLIENT_SCHEMA %>.<%= signature['function_name'] %> (<%= signature['argument_data_types'] %>)
RETURNS <%= signature['result_data_type'] %> AS $$
DECLARE
  ret <%= signature['result_data_type'] %>;
BEGIN
  -- TODO: this is to be changed according to the feature doc
  SELECT <%= GEOCODER_CLIENT_SCHEMA %>._geocode_admin0_polygon(session_user, txid_current(), <%= signature['argument_data_types'] %>) INTO ret;
  RETURN ret;
END;
$$ LANGUAGE 'plpgsql' SECURITY DEFINER;

--------------------------------------------------------------------------------

CREATE OR REPLACE FUNCTION <%= GEOCODER_CLIENT_SCHEMA %>._<%= signature['function_name'] %> (user_id name, tx_id bigint, <%= signature['argument_data_types'] %>)
RETURNS Geometry AS $$
  CONNECT <%= GEOCODER_CLIENT_SCHEMA %>._server_conn_str();
  SELECT cdb_geocoder_server.<%= signature['function_name'] %> (user_id, tx_id, signature['argument_data_types']);
$$ LANGUAGE plproxy;
